SHELL := /bin/bash

# not probed
HAVE_ALSA := y
HAVE_DV := y
HAVE_ESOUND := y
HAVE_FIREWIRE := y
HAVE_OSS := y
HAVE_XFT := y
HAVE_VIDEO4LINUX := n

# probed, uncomment and set to override probe
#STATIC_LIBRARIES := y
#HAVE_VIDEO4LINUX2 := y
#HAVE_DVB := y
#HAVE_GL := y
#HAVE_DL := y
#HAVE_NUMA := y

OBJDIR := $(shell uname -m)

GLOBAL_CONFIG := $(lastword $(wildcard ./global_config ../global_config ../../global_config))
TOPDIR := $(dir $(GLOBAL_CONFIG))
BINDIR := $(TOPDIR)/bin
PLUGIN_DIR := $(BINDIR)/plugins
# abs path
THIRDPARTY := $(shell cd $(TOPDIR)/thirdparty; pwd)

ifeq ($(origin CFLAGS), environment)
HAVE_CFLAGS := y
else
HAVE_CFLAGS := n
endif


PREFIX = /usr/
LIBPREFIX = $(PREFIX)/lib


CC = g++
GCC = gcc

ifneq ($(HAVE_CFLAGS), y)
CFLAGS = -O2 -g -fno-omit-frame-pointer
CFLAGS += -pthread -fno-math-errno -fno-signed-zeros
endif
CFLAGS += -Wall

ifeq ($(HAVE_GL), y)
CFLAGS += -DHAVE_GL
endif

ifeq ($(HAVE_XFT), y)
CFLAGS += -DHAVE_XFT
endif

ifeq ($(HAVE_ESOUND), y)
ESOUND_DIR := $(THIRDPARTY)/esound
AUDIOFILE_DIR := $(THIRDPARTY)/audiofile
ESOUNDCFLAGS = -DHAVE_ESOUND -I$(ESOUND_DIR) -I$(AUDIOFILE_DIR)
ESOUNDLIBS = $(ESOUND_DIR)/$(OBJDIR)/libesound.a
endif

#CFLAGS += -g
CFLAGS += -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64

# the directory for plugin includes
#FREETYPE_DIR := $(shell expr $(THIRDPARTY)/freetype-* )
FREETYPE_DIR := $(shell pkg-config --cflags freetype2 )
CFLAGS += $(FREETYPE_DIR) -I$(TOPDIR)

ifeq ($(HAVE_ALSA), y)
CFLAGS += $(ALSA_CFLAGS)
endif

ifeq ($(HAVE_OSS), y)
CFLAGS += -DHAVE_OSS
endif

ifeq ($(HAVE_DVB), y)
CFLAGS += -DHAVE_DVB
endif

ifeq ($(HAVE_FIREWIRE), y)
CFLAGS += -DHAVE_FIREWIRE
endif

ifeq ($(HAVE_VIDEO4LINUX), y)
CFLAGS += -DHAVE_VIDEO4LINUX
endif

ifeq ($(HAVE_VIDEO4LINUX2), y)
CFLAGS += -DHAVE_VIDEO4LINUX2
endif

ifeq ($(HAVE_DV), y)
CFLAGS += -DHAVE_DV
endif

ifeq ($(OBJDIR), alpha)
CXXREPOSITORY = cxx_repository/*.o
endif

$(shell mkdir -p $(OBJDIR) )


LFLAGS = 
LDLINKER = g++ -shared 


LOOP_BEGIN = @ for i in $(DIRS) ; \
	do \
	

LOOP_END = done

#EXTRA_LIBS += -L/usr/local/lib
#CPATH = /usr/local/include

ifeq ($(HAVE_DL), y)
EXTRA_LIBS += -ldl
EXTRA_FFMPEG_CFG += --extra-ldflags="-ldl"
endif

ifeq ($(HAVE_NUMA), y)
EXTRA_LIBS += -lnuma
endif

CFLAGS += -D__STDC_CONSTANT_MACROS
CFLAGS += -D__STDC_LIMIT_MACROS
CFLAGS += -DPNG_SKIP_SETJMP_CHECK=1
